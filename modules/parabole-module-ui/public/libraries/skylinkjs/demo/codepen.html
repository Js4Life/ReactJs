<!DOCType html>
<html>
<head>

<title>WebRTC with SkylinkJS</title>
    
<script src="//cdn.temasys.com.sg/skylink/skylinkjs/0.6.0/skylink.complete.js"></script>

</head>
<body>

<video id="myvideo" style="transform: rotateY(-180deg);" autoplay muted></video>
<div id="peerlist"></div>

<script type="text/javascript">
  var skylink = new Skylink();
  skylink.on('peerJoined', function(peerId, peerInfo, isSelf) {
    console.info('peerJoined', peerId, peerInfo, isSelf);
    if(isSelf) return; // We already have a video element for our video and don't need to create a new one.

    var vid = document.createElement('video');
    vid.autoplay = 'autoplay';
    vid.id = peerId;
    document.getElementById('peerlist').appendChild(vid);
  });

  skylink.on('incomingStream', function(peerId, stream, isSelf, peerInfo) {
    console.info('incomingStream', peerId, stream, isSelf, peerInfo);
    if (isSelf) return;
    var vid = document.getElementById(peerId);
    attachMediaStream(vid, stream);
  });

  skylink.on('peerLeft', function(peerId, peerInfo, isSelf) {
    console.info('peerLeft', peerId, peerInfo, isSelf);
    if (isSelf) return;
    console.info(peerId, peerInfo, isSelf);
    var vid = document.getElementById(peerId);
    document.getElementById('peerlist').removeChild(vid);
  });

  skylink.on('mediaAccessSuccess', function(stream) {
    console.info('mediaAccessSuccess', stream);
    var vid = document.getElementById('myvideo');
    attachMediaStream(vid, stream);

  });

  skylink.init({
    apiKey: '90ca96d4-85d6-495e-8212-28d520a82184',
    defaultRoom: 'Room A'
  }, function() {
    skylink.joinRoom({
      audio: true,
      video: true
    });
  });
</script>
</body>
</html>